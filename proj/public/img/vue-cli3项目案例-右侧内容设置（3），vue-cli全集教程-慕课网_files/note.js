define(function(require,exports){require("/static/lib/util/md5.js"),require("/static/page/course/common/course_note.js");var a=require("/static/component/base/util/picViewer"),c={praise:"/course/praisenote",cancelPraise:"/course/cancelpraise",collect:"/course/collectnote"},h={};h.praise=function(a,h,v){_this=this,$.ajax({url:c.praise,data:{id:a,mid:h.attr("data-mid")},type:"GET",dataType:"json",success:function(a){if(0==a.result){var c=parseInt(v.text());v.text(c+1),h.addClass("on"),h.find("span").addClass("on icon-thumb-revert praise-anim"),h.attr("title","取消赞")}}})},h.cancel=function(a,h,v){$.ajax({url:c.cancelPraise,data:{id:a,mid:h.attr("data-mid")},type:"POST",dataType:"json",success:function(a){if(0==a.result){var c=parseInt(v.text());v.text(c-1),h.removeClass("on"),h.find("span").attr("class","icon-thumb-revert"),h.attr("title","点赞")}}})},h.collect=function(a,h,v){var C=h.attr("data-mid").split("|");return OP_CONFIG.userInfo&&OP_CONFIG.userInfo.uid==C[1]?void alert("亲亲"+(OP_CONFIG.userInfo.nickname?'"'+OP_CONFIG.userInfo.nickname+'"':"")+"，别采集自己的笔记哟~！"):void $.ajax({url:c.collect,data:{id:a,mid:C[0]},type:"GET",dataType:"json",success:function(a){if(0==a.result){var c=parseInt(v.text());v.text(c+1),h.addClass("on"),h.find("span").addClass("on icon-star-revert praise-anim"),h.find("i").text("已采集"),h.attr("title","已采集"),zhuge&&zhuge.track("PublishNotes",{Category:"免费课",platform:"web",CID:course_id})}}})};var v=function(a){if(0==$(".unnote").length){var c=a||"#js-note-container",h=$(c).find("li"),v=[];$(h).each(function(a){v.push($(h[a]).attr("id"))});var C=v.join(",");if($(".Jcollect",c).show(),isLogin){var _=[],I='<a title="编辑此条笔记" href="javascript:;" class="editnote post-action" target="_blank"><i class="icon icon-edit"></i><em>编辑</em></a><a title="删除此条笔记" href="javascript:;" class="delnote post-action" data-cid=""><i class="icon icon-del"></i><em>删除</em></a>';$(h).each(function(a){_.push($(h[a]).attr("authorid"))}),$(_).each(function(a){_[a]==OP_CONFIG.userInfo.uid&&($(h).eq(a).find(".actions .Jcollect").after(I),$(h).eq(a).find(".Jcollect").hide())})}$.ajax({url:"/course/AjaxUserNotesStatus",data:{ids:C},type:"GET",dataType:"json",success:function(a){if(0==a.result){var c=a.data,C=c.collections,_=c.praises;""!=C&&$(v).each(function(a){$(C).each(function(i){if(v[a]==C[i].src_note_id){var c=$(h).eq(a).find(".Jcollect"),_=C[i].collect_num;c.attr("title","已采集").addClass("on").find("i").html("已采集"),c.find("em").text(_)}})}),""!=_&&$(v).each(function(a){$(_).each(function(i){if(v[a]==_[i].note_id){var c=$(h).eq(a).find(".Jpraise"),C=_[i].praise_num;c.attr("title","取消赞").addClass("on").find("i").html("取消赞"),c.find("em").text(C)}})})}}})}};exports.resetOptionBtn=v,$(document).on("click",".Jpraise",function(){if(!OP_CONFIG.userInfo)return void require.async("login_sns",function(a){a.init()});var a=$(this).closest("li").attr("id"),c=$(this).find("em"),v=$(this);v.hasClass("on")?h.cancel(a,v,c):h.praise(a,v,c)}),$(document).on("click",".Jcollect",function(){if(!OP_CONFIG.userInfo)return void require.async("login_sns",function(a){a.init()});var a=$(this);if(a.hasClass("on"))return!1;var c=$(this).closest("li").attr("id"),v=$(this).find("em");h.collect(c,a,v)});var C=!1;$(document).off("click.shownotecode").on("click.shownotecode",".js-show-node-code",function(){if(!C){C=!0;var a=$(this).attr("data-id");require.async("../common/view_code",function(c){c.init("/course/viewnotecode",a,{})}),setTimeout(function(){C=!1},1e3)}}),$("#noteContainer").on("click",".js-catch-pic",function(){var c=$(this).data("src");a.create(c)})});