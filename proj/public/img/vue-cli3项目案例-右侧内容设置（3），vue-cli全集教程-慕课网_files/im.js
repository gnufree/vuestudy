define(function(require){function a(a){for(var c,h={},g=document.cookie.split(/ *; */),i=0;i<g.length;++i)c=g[i].split("="),h[decodeURIComponent(c[0])]=decodeURIComponent(c[1]);return a?h[a]:h}if(require("socket.io"),$.chat={},$.chat={iosocket:null,unreadEvent:null,uid:0,port:80,ready:[],analyzeData:null,events:{},ie:navigator.userAgent.match(/(?:\b(MS)?IE\s+|\bTrident\/7\.0;.*\s+rv:)(\d+)/),init:function(){this.iosocket=this.ie&&this.ie[2]<10?io("https://im.mukewang.com",{enablesXDR:!0,upgrade:!1,transports:["polling"],path:"/message",reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:6e5,secure:!0}):io("https://im.mukewang.com",{transports:["websocket"],path:"/message",reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:6e5,secure:!0});var c=a(),h=(c.cninfo||"").split("-"),g=c.imooc_uuid,w=c.imooc_isnew;this.analyzeData={marking:h[1]||"",channel:h[0]||"",uuid:g||"",isnew:w||1,url:window.location.href,uid:OP_CONFIG.userInfo&&OP_CONFIG.userInfo.uid||0,isweb:1};for(var _ in this.events)this.iosocket.on(_,this.events[_]);this.iosocket.on("connect",function(){var i,a,c=$.chat,h=c.ready||[],g=c.iosocket;for(i=0,a=h.length;a>i;i++)g.emit.apply(g,h[i])}),this.checkUnreads()},login:function(a){a.expand=this.analyzeData,this.iosocket.emit("login",a)},emit:function(a,c){this.ready?this.ready.push(arguments):this.iosocket.emit(a,c)},bandUnreads:function(a,c){a&&c&&(this.uid=a),this.events.unreads=c,this.iosocket&&this.iosocket.on("unreads",c)},checkUnreads:function(){this.analyzeData.uid=this.uid,this.emit("unreads",this.analyzeData),this.uid>0},bindEvent:function(a,c){this.iosocket?this.iosocket.on(a,c):this.events[a]=c},send:function(a,c){this.iosocket.emit(a,c)}},OP_CONFIG.userInfo&&OP_CONFIG.userInfo.uid){var c,h=window.location.href.indexOf("notices"),g=window.location.href.indexOf("messages");$.chat.bandUnreads(OP_CONFIG.userInfo.uid,function(a){a>0?($(".msg_remind").show(),_msg_unread=1,(-1!=h||-1!=g)&&(a>99?$("#msg_new").find(".msg-num").html("(99+)").show():$("#msg_new").find(".msg-num").html("("+a+")").show())):(_msg_unread=0,c||$(".msg_remind").hide(),$("#msg_new").find(".msg-num").hide())}),$.chat.bindEvent("remind",function(a){if(a.unreads>0){if($(".msg_remind").show(),c=1,-1!=h||-1!=g){var w=$("#not_new").find(".not-num"),_=w.html();if(""==_)$("#not_new").find(".not-num").attr("data-num",1),$("#not_new").find(".not-num").html("(1)").show();else{var k=parseInt(w.text().substr(1,w.text().length-2)),v=parseInt(k+1);$("#not_new").find(".not-num").attr("data-num",v),99==v?w.show().html("(99+)"):w.html("("+v+")")}}}else c=0,_msg_unread||$(".msg_remind").hide()})}});