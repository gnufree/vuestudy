define(function(require){function a(a){w||(w=1,location.href=a)}function c(a,c,y){var h=new Date;h.setDate(h.getDate()+y),document.cookie=a+"="+escape(c)+(null==y?"":";expires="+h.toGMTString())+";path=/;domain=.imooc.com"}function y(){if("number"!=typeof continueTime){continueTime=0;var a=v.get("_vt");a&&a[pageInfo.mid]&&(continueTime=a[pageInfo.mid].st||0)}h(continueTime)}function h(c){var y=!1,h=window.location.protocol.split(":")[0],v="http://www.imooc.com/course/playlist/"+pageInfo.mid+"?t=m3u8&_id="+OP_CONFIG.mongo_id+"&ssl=0";"https"===h&&(v="https://www.imooc.com/course/playlist/"+pageInfo.mid+"?t=m3u8&_id="+OP_CONFIG.mongo_id),window.thePlayer=mocoplayer($("#video-box"),{url:v,title:videoTitle,currentTime:c,events:{onReady:function(){"html5"==this.getPlayType()&&this.play()},onComplete:function(){k(),window.clearInterval(_),y=!0,_=null;var c=$(".J_next-box"),h=c.find(".J-next-course");if(c.removeClass("hide").show(),I(),h.length){var v=$(".J-next-btn"),g=h.data("next-src");v.removeClass("hide").on("click",function(){a(g)})}else{var w={getData:function(a,c,y){var h=this;$.ajax({type:"GET",url:"/course/"+a,data:{cid:course_id},dataType:"json",success:function(a){if(0==a.result){var v=a.data;v.length&&(h.bindData(v.slice(0,2),c[0],y[0]),h.bindData(v.slice(2,5),c[1],y[1]))}}})},bindData:function(a,c,y){var h,v,g="",w="";$(a).each(function(c){2==a[c].type?(h="//coding.imooc.com/class/"+a[c].id+".html",v=a[c].pic):(h="/learn/"+a[c].id,v="//img.mukewang.com/"+a[c].pic+"-240-135.jpg"),w+='<li class="l">                                                    <a href="'+h+'" target="_blank">                                                        <img src="'+v+'"/>                                                    </a>                                                    <a href="'+h+'" target="_blank" class="recom-course-title">                                                        '+a[c].name+"                                                    </a>                                                </li>"}),"first-row"==c?(g='<ul class="l">'+w+"</ul>",$(y).before(g)):(g='<div class="recom-course-row"><ul class="clearfix">'+w+"</ul></div>",$(y).after(g))}};w.getData("ajaxlastmediarecom",["first-row","second-row"],[".first-row .other-oper",".first-row"])}},onPlay:function(){$(".J_next-box").hide()},onError:function(){}}})}var v=require("store"),g=require("./common/animate-achievement");require("lib/juicer/juicer.min.js"),require("/static/moco/player/3.0.6.3/mocoplayer"),require("/static/page/course/common/course_detail_common.js");var w=!1,_=null,j="visibilityState";"undefined"!=typeof document.mozHidden?j="mozVisibilityState":"undefined"!=typeof document.msHidden?j="msVisibilityState":"undefined"!=typeof document.webkitHidden&&(j="webkitVisibilityState"),isLogin&&y(),$(window).on("beforeunload",function(){function a(){var y,h,i=0,v=(new Date).getTime();for(y in c)i++,c[y].t<v&&(v=c[y].t,h=y);i>=10&&(delete c[h],a())}var c=v.get("_vt")||{},y=c[pageInfo.mid];if(thePlayer.getCurrentTime)return $(".J_next-box").hasClass("hide")?void(y?(y.t=(new Date).getTime(),y.st=thePlayer.getCurrentTime(),v.set("_vt",c)):(y={t:(new Date).getTime(),st:thePlayer.getCurrentTime()},a(),c[pageInfo.mid]=y,v.set("_vt",c))):(delete c[pageInfo.mid],void v.set("_vt",c))});var b=function(){$.ajax({url:"//www.imooc.com/wechat/qrcode",type:"post",data:{method:-1},dataType:"json",success:function(a){0==a.result&&($(".js-wechat-box").hide(),c("showwechat","1",7))}})},T=function(){var a=document.getElementById("copy-qqun_command");a.select(),document.execCommand("Copy"),$(".js-copy-tip").fadeIn("normal",function(){setTimeout(function(){$(".js-copy-tip").fadeOut()},3e3)})},k=function(){$.ajax({url:"/course/ajaxvideoaddgroup?cid="+course_id,type:"GET",dataType:"json",success:function(a){if(1e3==a.result&&a.data){var c=a.data.qqun_content,y='<div class="qqQun-qrcode" style="background-image:url('+c.qq_pic+')"></div>                        <div class="content">                            <div class="row">                                <span class="title">'+c.qq_name+'</span>                                <span class="desc">'+a.data.qqun_intro+'</span>                            </div>                            <div>                                <span class="number">QQ群：'+c.qq_num+'</span>                                <span class="check js-qqQun-check">加群验证信息：'+a.data.qqun_command+'</span>                                <input id="copy-qqun_command" style="position:fixed;left:-999px;top:-999px;" value="'+a.data.qqun_command+'">                                <div class="copy-con">                                    <img class="copy js-qqQun-copy" src="/static/img/course/copyInfo.png">                                    <p class="copy-tip js-copy-tip">复制成功啦！</p>                                </div>                            </div>                        </div>                        <a class="qqQun-addBtn" target="_blank" href="'+c.qq_url+'">                            点击加群                        </a>                        <div class="qqQun-close js-qqQun-close">                            <i class="imv2-close1"></i>                        </div>';$(".js-qqQunAdd").html(y).css("display","flex"),"1"==a.data.is_pay&&$.ajax({url:"//order.imooc.com/api/pay/getorderid",type:"post",dataType:"json",data:{type:8,type_id:course_id},xhrFields:{withCredentials:!0},success:function(a){1e3==a.errorCode&&($(".js-qqQun-check").text("加群验证信息："+a.data.trade_number),$("#copy-qqun_command").val(a.data.trade_number))}})}}})},C=function(){var a=($(".course-subnav").width()-$(".course-subnav ul").outerWidth())/2;a>60?$("#js-ques-box").css("left",a):$("#js-ques-box").css("left",60)},I=function(){if(OP_CONFIG.userInfo){var a,c={},y=0,h=(new Date).getTime();return c.mid=pageInfo.mid,_=window.setInterval(a=function(){var a,v;"hidden"!=document[j]&&"object"==typeof thePlayer&&thePlayer.getCurrentTime&&(a=(new Date).getTime(),v=parseInt(a-h)/1e3,c.time=30,c.learn_time=thePlayer.getCurrentTime(),$.ajax({url:"/course/ajaxmediauser/",data:c,type:"POST",dataType:"json",success:function(a){if("0"==a.result){y=v;var c=a.data.media,h=a.data.course,a=[];c&&a.push({mp:c.mp.point,desc:c.mp.desc}),h&&a.push({mp:h.mp.point,desc:h.mp.desc}),g(a),c&&($("#J_ques_pop").show(),window.onresize=C,C())}else"-105002"==a.result&&$.alert("你的账号在另一地点登录，已被强迫下线。",{info:"如果不是本人操作，建议你修改密码。",callback:function(){window.location.href="//coding.imooc.com"}})}}))},3e4),window.onbeforeunload=function(){var a,v;"object"==typeof thePlayer&&thePlayer.getCurrentTime&&(a=(new Date).getTime(),v=parseInt(a-h)/1e3,c.time=30,c.learn_time=thePlayer.getCurrentTime(),$.ajax({url:"/course/ajaxmediauser/",data:c,type:"POST",async:!1,dataType:"json",success:function(a){"0"==a.result&&(y=v)}}))},a}}();$("#js-ques-box").delegate(".Js-change-ques","click",function(){var a,c=$("#ques-group li"),y=$("#ques-group").find("li.curr"),h=y.removeClass("curr").index(),v=c.length-1;h===v?c.eq(0).addClass("curr"):y.next().addClass("curr"),a=$("#ques-group .curr").find(".ques-title").attr("href"),$("#js-to-answer").attr("href",a)}),$("#js-ques-box").on("click","#J_issue_Close,.ques-title,#js-to-answer",function(){$("#J_ques_pop").hide()}),$(document).on("click",".js-wechat-close",function(){b()}),$(document).on("click",".js-qqQun-close",function(){$(".js-qqQunAdd").hide()}),$(document).on("click",".js-qqQun-copy",function(){T()}),function(){var a=function(){var a={};return a.resetSize=function(){var a="100%",c=$("#header").outerHeight(!0),y=$(".js-course-subnav").outerHeight(!0),h=$(window).height()-c-y;$(".js-box-wrap").css("width",a).css("height",h+"px"),$(".course-right-nano").css("height",h+"px"),h>500?$(".question-tip-layer").css("marginTop","6%"):h>400&&500>h?$(".question-tip-layer").css("marginTop","3%"):400>h&&$(".question-tip-layer").css("marginTop","1%")},a}(),c=function(){{var a=$(".js-course-menu"),c=$(".course-left"),y=c.offset().top,h=c.offset().left;$(".js-fixed-video")}return $(window).on("scroll",function(){var c=$(window).scrollTop();c>=y?a.css("position","fixed").css("left",h+"px"):a.css("position","absolute").css("left",0)}),{setLT:function(){y=c.offset().top,h=c.offset().left}}}();a.resetSize(),c.setLT(),$(window).on("resize",function(){setTimeout(function(){a.resetSize(),c.setLT(),$(window).trigger("scroll")},200)})}(),function(){function a(){var n=0,a={};$.each(w,function(c,h){$.getJSON(h[0],g[c],function(c){0==c.result&&(a[h[0]]=c.data),n++,n==w.length&&y(a)})})}function c(a){return $.each(a,function(a,c){if(!isNaN(c.easy_type)){var y="";switch(Number(c.easy_type)){case 1:y="入门";break;case 2:y="初级";break;case 3:y="中级";break;case 4:y="高级";break;case 5:y="专业"}return c.easy_type=y,!0}return!1}),$.each(a,function(a,c){"undefined"!=typeof c.course_type?"免费"==c.course_type?c.course_type="MF":"实战"==c.course_type?c.course_type="SZ":"路径"==c.course_type&&(c.course_type="LJ"):1==c.type?c.course_type="MF":2==c.type&&(c.course_type="SZ")}),a}function y(a){var y="";$.each(w,function(g,w){var $=a[w[0]];if($.length){if(0==g)var _=v,j={title:w[1],data:$,isLogin:isLogin};else var _=h,j={title:w[1],data:c($)};y+=juicer(_,j)}}),$(".video-panel .panel-container").append(y)}var h=($("#v-teachers-tpl").html(),$("#v-course-tpl").html()),v=$("#recommend-zhuanlan-tpl").html(),g=[{course_id:course_id},{cid:course_id,tid:$("#teacher_id").val()},{cid:course_id,type:"related"}],w=[["/article/ajaxrecommendspecialcolumn","专栏推荐"],["/lecturer/ajaxgettcourse","讲师课程"],["/course/ajaxcourserelate","相关课程"]];a()}()});