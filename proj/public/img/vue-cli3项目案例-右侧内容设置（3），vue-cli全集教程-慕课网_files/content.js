define(function(require){var a=require("./base.js");require("lib/juicer/juicer.min.js"),require("lib/pagination/jquery.pagination.js"),require("/static/lib/util/md5.js"),require("./qa.js");var c=require("./note.js");juicer.register("nl2br",function(a){return"string"==typeof a?a.replace(/[\n|\r]/g,"<br>"):""}),juicer.register("getScriptHtml",function(a,c,h){return'<script type="text/plain" id="js-editor-'+c+"_"+h+'">'+a+"</script>"});var h=function(a){var c=a.toString(16);return c.length>5?c:5==c.length?"l"+c:(c=$.md5(c)+"l"+c,c.substr(-6))},g=pageInfo.mid,v={init:function(){var c=this;a.tabSlider.create(null,{menu:".js-course-subnav li",block:".js-tab-item",currClass:"current",callback:function(i){var a=$(".js-course-subnav li").eq(i).attr("data-type");a&&c.link(a)}}),this.render(),this.bindEvent()},bindEvent:function(){var c=this;$(document).on("click",".js-lookme",function(){var a={};$(this).hasClass("on")?$(this).removeClass("on"):($(this).addClass("on"),a.ower="my"),a.sort=$(this).parents(".js-tab-item").find(".moco-change-smalle-btn active").attr("data-sort"),c.render(a)}),$(document).on("click",".moco-change-smalle-btn",function(){return $(this).hasClass("active")?!1:($(this).addClass("active").siblings().removeClass("active"),void c.change.call(this,c))});var h=!1;$(document).on("click",".js-lookcode",function(){if(!h){h=!0;var a=$(this).attr("data-id");require.async("../common/view_code",function(c){c.init("/course/viewexamcode",a,{})}),setTimeout(function(){h=!1},1e3)}}),$(document).on("click",".js-code-praise",c.codePraise),$(document).on("click",".js-link-qa",function(){$('.js-course-subnav li[data-type="qa"]').trigger("click"),$(window).scrollTop($(".js-course-subnav").offset().top)}),a.on("qaPanel/render",function(){c.removeCache("qa")}),a.on("notePanel/render",function(){c.removeCache("note")}),a.on("commentPanel/render",function(){c.removeCache("comment")})},removeCache:function(a){var c=this.cache.indexOf(a);c>-1&&this.cache.splice(c,1),this.current==a&&this.render()},codePraise:function(e){e.preventDefault();var a,c=$(this);return $(this).hasClass("active")?!1:OP_CONFIG.userInfo?(a=c.attr("data-id"),void $.ajax({url:"/course/codesupport",data:{id:a},dataType:"json",success:function(a){if(0==a.result){var h=+c.text();c.find("em").text(h+1),c.addClass("active")}},error:function(){}})):void require.async("login_sns",function(a){a.init()})},change:function(a){var c=$(this).parents(".js-tab-item").data("type");"qa"==c||"comment"==c?a.render($(this).attr("data-t"),1):"note"==c&&a.render({sort:$(this).attr("data-sort"),ower:$(".js-lookme").hasClass("on")?"my":"all"})},link:function(a){return a==this.current?!1:(this.current=a,void(this.cache.indexOf(a)<0&&this.render()))},cache:[],cachePush:function(a){return this.cache.indexOf(a)>=0?!1:void this.cache.push(a)},render:function(){var g=this,o=this.Options[this.current];this.cachePush(this.current);var v=o.getOptions(arguments),j=this;$.getJSON(v.url,v.data,function(v){var b=v.data;b.userInfo=OP_CONFIG.userInfo,b.sort=o.sort||"",b.url=window.location.pathname,b.flag="main";var C=[];b.list=b.list||[],"note"==j.current?$.each(b.list,function(a,c){c._url=h(parseInt(c.id)),C.push(c)}):$.each(b.list,function(a,c){C.push(c)}),b.list=C,o.container.html(juicer(o.tpl,b)),o.pagination.html(""),"note"==j.current&&(c.resetOptionBtn("#noteContainer"),a.emit("noteList/render")),a.emit("noteList/render"),b.page_size=b.page_size||20,b.page=b.page||b.page_current,twemoji&&twemoji.parse(document.body),b.total>b.page_size&&o.pagination.pagination(b.total,{prev_text:"上一页",next_text:"下一页",items_per_page:b.page_size,num_display_entries:3,num_edge_entries:1,current_page:b.page-1,callback:function(a){o.page=a+1,$(window).scrollTop($(".js-course-subnav").offset().top),g.render()}})})},current:"qa",Options:{qa:{tpl:$("#qa-tpl").html(),container:$("#qaContainer"),pagination:$(".c-qalist .pagination"),url:"/course/ajaxqa/id/"+g,t:"/t/2",sort:"qa",page:"1",getOptions:function(a){var t=a[0],c=a[1],h=a[2],g={page:this.page},v="";return t&&(this.t=t),v=this.t?this.url+this.t:this.url,h&&(g.cache=0),c&&(g.page=c),{data:g,url:v}}},comment:{tpl:$("#qa-tpl").html(),container:$("#commentContainer"),pagination:$(".c-comment .pagination"),url:"/course/ajaxqa/id/"+g,t:"/t/1",sort:"comment",page:"1",getOptions:function(a){var t=a[0],c=a[1],h=(a[2],{page:this.page}),g="";return t&&(this.t=t),g=this.t?this.url+this.t:this.url,c&&(h.page=c),{data:h,url:g}}},note:{tpl:$("#note-tpl").html(),container:$("#noteContainer"),pagination:$(".c-notelist .pagination"),url:"/course/mynote",page:"1",getOptions:function(a){var c=a[0],h={};return h.mid=g,h.page=this.page,h.r=Math.random(),h.sort="last",h.ower=$(".js-lookme").hasClass("on")?"my":"all",h=$.extend(h,c||{}),{url:this.url,data:h}}},code:{tpl:$("#code-tpl").html(),container:$("#codeContainer"),pagination:$(".c-codelist .pagination"),url:"/course/otherscode",page:"1",getOptions:function(a){var c=a[0],h={};return h.mid=g,h.page=this.page,h=$.extend(h,c||{}),{url:this.url,data:h}}}}};v.init()});